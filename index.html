<!DOCTYPE HTML>
<html>
<head>
  <style>
  body {
    margin: 0px;
    padding: 0px;
  }
  </style>
</head>
<body>
  <canvas id="myCanvas" width="1000" height="600"></canvas>
  <script>
  var x =  0;
  var x1;
  var speed = -5;
  var grassLen=5;
  var gorgeSize=1; //5 tikmes size of grass sprite
  var loop1=true; //for grass
  var loop2=false; //for grass
  var lastX;
  var xSpawn=-10; //reinititalized in end
  var canvas = document.getElementById('myCanvas');
  var context = canvas.getContext('2d');
  var playerY;
  var playerX=canvas.width*0.05;
  var playerYDefault;
  var jump=false;
  var jumpDir=-5;
  var grass;
  var obstacles=[];
  window.addEventListener('keydown', whatKey, true);
  //var currentPLayerY=playerY;
  var player = new Image();
  setInterval(generateObstacle, 2000);

  player.onload = function() {
    playerY=canvas.height*0.85-player.height;
    playerYDefault=playerY;
    context.drawImage(player,playerX,playerY);
  };
  player.src = 'player.png';

  var grassX=-10 //Least position for x ; reinitialezed in end 
  x1=canvas.width;
  function animate() {

    reqAnimFrame = window.mozRequestAnimationFrame    ||
    window.webkitRequestAnimationFrame ||
    window.msRequestAnimationFrame     ||
    window.oRequestAnimationFrame
    ;

    reqAnimFrame(animate);

    /* Grass Coding Begin*/
    /*if(loop1)
      x += speed;
    if(loop2)
      x1+= speed;*/

    if(x < grassX){
      x=canvas.width;
      loop1=false;
    }
    else if(x1 < grassX){
      x1=canvas.width;
      loop2=false;
    }
    if(x<xSpawn)
    {
      loop2=true;
    }
    else if(x1<xSpawn)
    {
      loop1=true;
    }
    /* Grass Coding end*/

    /*player code begin */
    if(loop1 && loop2 && !jump && ( (x-grassX<playerX && x1>playerX+player.width)||(x1-grassX<playerX && x>playerX+player.width)))
    {
      console.log("OUT");

    }
    /*Player code end*/
    //console.log(loop1+" "+loop2+" "+x +" "+ xSpawn);
    draw();
  }


  function draw() {

    /* Grass Coding Begin*/
    var grass= new Image();
    grass.onload = function() {

    //grass loop x
    for(var i=0;i<grassLen && loop1;i++)
    {
      context.clearRect(x+grass.width*i, canvas.height*0.85, grass.width,grass.height );
      context.drawImage(grass,x+grass.width*i, canvas.height*0.85, grass.width,grass.height );
    }
    lastX=grass.width*grassLen;
    if(loop1)
    {
      context.clearRect(x+lastX,canvas.height*0.85,grass.width,grass.height);
      x+=speed;
    }

    //grass loop x1
    for(var i=0;i<grassLen && loop2;i++)
    {
      context.clearRect(x1+grass.width*i, canvas.height*0.85, grass.width,grass.height );
      context.drawImage(grass,x1+grass.width*i, canvas.height*0.85, grass.width,grass.height );
    }
    if(loop2)
    {
      context.clearRect(x1+lastX,canvas.height*0.85,grass.width,grass.height);
      x1+=speed;
    }

      
  };
  grass.src = 'water.png';
  /* Grass Coding End*/

  /*Player coding Begin*/
  if(jump)
  {
    var player = new Image();
    player.onload = function() {
      context.clearRect(playerX,playerY,player.width,player.height);
      if(playerY<=canvas.width/5)
        jumpDir*=-1;
      playerY+=jumpDir;
      context.drawImage(player, playerX,playerY);
      if(playerY==playerYDefault)
      {
        jump=false;
        jumpDir*=-1;
      }
    };
    player.src = 'player.png';
  }

  /*Player Coding end*/

  /*obstacle coding begin*/


  /*obstacle coding end*/


}

animate();
grass=new Image();
grass.onload = function() {

  grassX=grass.width*grassLen*-1
  xSpawn=canvas.width-grass.width*gorgeSize+grassX;
};
grass.src="water.png";

function generateObstacle()
{
	console.log("generated");
	var fire=new Image();
	fire.onload=function(){
		context.drawImage(fire,canvas.width*0.5,canvas.height*0.85-fire.height);
	};
	fire.src="fire.png";
}

function whatKey(evt) 
{

  if (evt.keyCode==32) 
  {
    jump=true;
    console.log("space");
  }
}
</script>
</body>
</html>      